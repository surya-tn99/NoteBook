<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Markdown Directory</title>
  <style>
    body {
      font-family: sans-serif;
    }

    ul {
      list-style-type: none;
      padding-left: 1rem;
    }

    .folder {
      font-weight: bold;
      color: darkblue;
      cursor: pointer;
    }

    .file {
      color: darkgreen;
      cursor: pointer;
    }

    .actions {
      margin-left: 10px;
    }

    .delete-btn {
      color: red;
      margin-left: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    button {
      margin: 4px;
      padding: 6px 10px;
      border: none;
      background-color: #4CAF50;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #388E3C;
    }

    #file-viewer {
      margin-top: 1rem;
      white-space: pre-wrap;
      background: #f4f4f4;
      padding: 10px;
      border: 1px solid #ccc;
    }
  </style>
</head>

<body>
  <h2>Markdown Directory (Frontend Only)</h2>
  <div>
    <button onclick="addNote()">Add Notes</button>
    <button onclick="addFolder()">Add Folder</button>
    <button onclick="goBack()">Back</button>
  </div>
  <hr>
  <div id="tree-container"></div>
  <div id="file-viewer"></div>

  <script>
    let data = [
      { id: 1, name: "root", is_file: false, parent_id: null, content: "" },
      { id: 2, name: "hello.md", is_file: true, parent_id: 1, content: "# Hello Markdown" },
      { id: 3, name: "folder name 1", is_file: false, parent_id: 1, content: "" },
      { id: 4, name: "file inside the folder 1", is_file: true, parent_id: 3, content: "# New Markdown" },
      { id: 5, name: "file on root", is_file: true, parent_id: 1, content: "# New Markdown" },
      { id: 6, name: "hai", is_file: true, parent_id: 1, content: "# New Markdown" },
      { id: 7, name: "hai", is_file: true, parent_id: 1, content: "# New Markdown" }
    ];

    let currentFolderId = 1;
    const historyStack = [];

    function renderTree(parentId) {
      const children = data.filter(item => item.parent_id === parentId);
      let html = '<ul>';
      for (const node of children) {
        if (node.is_file) {
          html += `
            <li class="file">
              <span onclick="viewFile(${node.id})">${node.name}</span>
              <span class="delete-btn" onclick="deleteNode(${node.id})">✖</span>
            </li>`;
        } else {
          html += `
            <li class="folder">
              <span onclick="enterFolder(${node.id})">${node.name}</span>
              <span class="delete-btn" onclick="deleteNode(${node.id})">✖</span>
            </li>`;
        }
      }
      html += '</ul>';
      document.getElementById("tree-container").innerHTML = html;
      document.getElementById("file-viewer").textContent = "";
    }

    function enterFolder(folderId) {
      historyStack.push(currentFolderId);
      currentFolderId = folderId;
      renderTree(currentFolderId);
    }

    function goBack() {
      if (historyStack.length > 0) {
        currentFolderId = historyStack.pop();
        renderTree(currentFolderId);
      }
    }

    function viewFile(fileId) {
      const file = data.find(f => f.id === fileId);
      document.getElementById("file-viewer").textContent = file.content || "(empty file)";
    }

    function addNote() {
      const name = prompt("Enter file name (e.g., notes.md):");
      if (!name) return;
      const newId = getNextId();
      data.push({
        id: newId,
        name,
        is_file: true,
        parent_id: currentFolderId,
        content: "# New Markdown"
      });
      renderTree(currentFolderId);
    }

    function addFolder() {
      const name = prompt("Enter folder name:");
      if (!name) return;
      const newId = getNextId();
      data.push({
        id: newId,
        name,
        is_file: false,
        parent_id: currentFolderId,
        content: ""
      });
      renderTree(currentFolderId);
    }

    function deleteNode(id) {
      if (!confirm("Are you sure you want to delete this item?")) return;

      const toDelete = getAllChildren(id);
      toDelete.push(id); // include the node itself

      data = data.filter(node => !toDelete.includes(node.id));
      renderTree(currentFolderId);
    }

    function getAllChildren(parentId) {
      const children = data.filter(item => item.parent_id === parentId);
      let all = [];
      for (const child of children) {
        all.push(child.id);
        if (!child.is_file) {
          all = all.concat(getAllChildren(child.id));
        }
      }
      return all;
    }

    function getNextId() {
      return Math.max(...data.map(d => d.id)) + 1;
    }

    renderTree(currentFolderId);
  </script>
</body>

</html>
